# 一种多特征融合的图像鉴伪方法

王鹏钧常晓敏杨基宏刘海敏（中国人民解放军96901部队22分队北京100094）(101351799@qq.com)

摘要随着信息技术的发展，数字图像等多媒体信息几乎遍布互联网的每个角落，面对技术进步带来的各种伪造手段，真实图像很容易被恶意篡改而不留下任何明显的痕迹，而图像鉴伪技术为法庭诉讼等领域提供了技术支持，对社会发展具有重要的研究意义.提出采用基于RGB的ELA和基于CMYK的ELA融合，同时融合Laplacian算子提取到的边缘特征以及灰度共生矩阵GLCM提取到的纹理特征，并融合CNN自动学习到的特征进行图像鉴伪，实验结果表明，该方法在CASIA数据集和Columbia数据集上在保证其复杂度的情况下准确率能够达到 $93 \%$

关键词 1 ELA;CMYK;Laplacian算子；灰度共生矩阵GLCM；CNN；图像篡改

中图法分类号 TP393

随着手机、平板电脑软件的推陈出新，对图像的篡改不仅能在专业的系统和设备上完成，每个普通人都可以通过各种“美图软件"对照片进行修改.虽然正向的图像篡改可以使照片更完美、更赏心悦目；但是不乏有许多不法分子采用各种手段伪造图片，以假乱真，互联网传播速度快，不仅可能会对个人的声誉和利益造成巨大的影响，更不利于社会的稳定与团结，甚至可能对国家安全造成巨大的影响.因此，做好数字图像鉴伪的工作，对维持社会秩序，维护国家企业安全等都是一件兴利除弊的举措.

目前传统的图像篡改取证方式通常具有对单一篡改技术的鉴别能力，深度学习可以自适应地提取篡改特征，但是这种自适应特征可控性较弱，可能含有与篡改特征无关的特征信息，导致计算量的增加甚至影响准确率.因此本文采用传统方法和深度学习特征融合的方法来进行图像篡改识别分别采用误差水平分析法、空间颜色法、亮度梯度法、灰度共生矩阵、改进结构的神经网络模型等几种算法融合进行图像篡改识别，探究了传统方法与深度学习方法在篡改取证方面的进展，并通过实验验证了这几种算法的效果

# 图像鉴伪技术研究

图像篡改方式目前分为2类：1)侧重于模糊、压缩、增强、缩放、滤波等，没有对图像的内容进行修改，大多是为了掩盖图像的篡改痕迹；2）侧重于拼接、复制一粘贴、删除，是对图像内容进行修改。拼接（splicing）是把别的图里面的某个区域拼接到另一张图.复制粘贴（copy_move）是在同一张图上进行部分区域的拷贝，然后放到图中的其他地方.删除（removal/inpainting）是将图像中某部分区域“移除”这3种操作是对图像内容进行修改，给人的误导性大，因此本文重点针对这3种方式篡改的图像进行取证

图像篡改取证技术分为传统方法和深度学习方法2类.传统方法是分析提取到的图像自然特征和人为特征来判断图像是否被篡改.这种方法表达能力有限，不能应对所有的图像篡改技术，大多只能针对一种图像篡改方法.深度学习主要是使用卷积神经网络（convolutionalneuralnetworks，CNN)模型自动提取并组合特征，通过这些特征训练分类器，实现端到端自适应学习模式，这种端到端自动检测系统最大的优势是自动学习特征参数，适应于多种篡改方式的识别

本文在分析这2种方法后，鉴于图像篡改是基于异常区域的，篡改内容不固定，而CNN分类网络是基于图像区域的一个特定物体的特征学习，显然篡改区域学习到的特征可控性较弱，因此本文将这2种方法进行特征融合，先通过传统方法提取到图像篡改的像素级内容，再输入CNN中进行该特征的分类学习，

# 1.1基于传统方法的图像鉴伪

1）ELA误差水平分析法

误差水平分析法（errorlevelanalysis，ELA）是比较经典的图像篡改取证算法.它是通过一定压缩比率重新绘制图像后分析误差分布，来判断图像是否进行过拼接、修改、涂抹等处理，即允许识别图像处理不同压缩级别的区域，突出显示图像压缩率的差异.原则上，原始图片各区域的ELA值应该是相似的，如果出现一块区域的ELA值显著异于图像其他部分，那么这一块区域很可能是后期修改重新保存过的.如图1所示，可见该图像河流轮廓和山体轮廓是高亮的而其他区域是暗黑的，说明这些高亮区域很可能后期被修改过

![](images/a427b6f3d349049d0a58d72d2a9e85c6da2f7e1d1295150aba4f6e8fdf01ee73.jpg)  
图1ELA图像处理结果图

# 2）空间颜色法

徐亮等人提出基于图像的Cb和 $\dot { \mathrm { C r } }$ 两个通道的色度分量来提取边缘信息矩阵，比RGB通道更容易检测拼接的痕迹；王品清等人[2使用CMYK变换处理图像，其算法简单、操作便捷而且还提供了4个通道的图像信息，应用于遥感图像处理中，并强调该CMYK变换是其他任何方法不能相比的.邢静等人提出更接近人类感知的HSV颜色模型.一般的图像篡改区域的边缘存在亮度色度等不一致现象.本文基于以上文献等通过实验进行了RGB，YCbCr，CMYK和HSV这几种颜色模型的对比，结果发现经过CMYK四通道的颜色变换后进行ELA误差水平分析的结果最佳，实验结果如图2所示：

![](images/1e0abd378b4fc3584bebfecd834463b8d8d733c528c4ff6a9cb9699c578714df.jpg)  
图2CMYK颜色空间转换

# 3）边缘特征提取

Laplacian算子是二阶边缘检测算子，是求梯度的散度，对边缘敏感，具有旋转不变性，能够检测任意方向的边缘.该算子容易受噪声影响，可能有些是噪声的边缘也会被计算在内，因此被篡改的图像区域的边缘很容易就检测到，尤其对明暗变化敏感，能够更好地呈现篡改区域图像边缘像素在整幅图中的明暗度，更好地提取到篡改特征；此外，一般的篡改图像会进行平滑等模糊处理，而Laplacian算子计算方差时对模糊图像处理效果好[4].一般的图像篡改区域的边缘存在明显的不连续现象，所以对边缘进行检测可以更好地判断图像是否被篡改，

# 4）纹理特征提取

灰度共生矩阵GLCM(Gray-level co-occrrencematrix主要是用来提取篡改区域部分的纹理特征.通过计算图像中灰度的空间分布得到它的共生矩阵，主要是计算图像中一定距离和一定方向的2个灰度之间的联合概率分布，也就是用条件概率来反映图像的纹理信息，该矩阵能够分析出图像的局部模式和排列规则[5，而且也能够对图像进行缩放.在篡改图像上提取的纹理特征的能够反映出篡改区域关于方向、相邻间隔、纹理变化幅度的综合信息.

# 1.2基于深度学习方法的图像鉴伪

目标检测网络通常比分类网络复杂度较高，本文主要对篡改图像进行鉴伪，旨在提取图像的有效特征，篡改分类网络验证VGG16网络效果好，因此基于VGG16提出了一种改进的CNN网络来更好地提升模型的鉴伪性能.

1）设计了一种可以鉴别图像篡改的残差网络，深度学习中网络越深学习到的特征越丰富，但是网络加深可能会导致各层的输入数据分布改变进而导致网络退化，同时多次的下采样虽然使得感受野增大，但是会丢失细节信息，而丢失的这些细节信息可能包含篡改特征.因此本文引入残差网络来进行图像篡改特征的学习.

2）激活函数给网络输出引入非线性元素，使得神经网络可以逼近任意的非线性函数.每个卷积层后面都会使用一个非线性层(激活函数)使得卷积后的特征能够引入非线性特征，一般是使用ReLU，本文使用Softplus[6，其返回值大于0，是ReLU的平滑版本，导数是连续的、非零的，避免了死亡神经元现象，同时能够加速模型收敛，

3）使用大小为 $4 \times 4$ 和步长为2的卷积替换最大池化下采样，提高图像表达能力.

4）一般的CNN网络在卷积后先归一化BN（batchnormalization）再进行激活非线性化，本文采用先激活再归一化这样效果更佳.BN能够限制输出范围，使得下一层网络的输入是标准化的输入，让所有的值都在相同的尺度范围内，否则，随着网络的深入数值会越来越大；使用激活函数后值域为没有上限的非负数，并且会把数据放大，同时可能会出现梯度消失的神经元.如果先使用BN再使用激活函数会降低激活函数的非线性能力，因此本文先使用激活函数再进行BN归一化来减少内部协变量转变加速网络训练

5）不采用迁移学习，主要是该网络提取的篡改特征不规则，模型不容易泛化，尤其在进行传统方法的特征提取后，使用预训练的模型会导致不可控的偏差.

6）使用加了动量的SGD即SGDM(SGDwithmomentum），并且使用了牛顿加速（SGDwithnesterovacceleration）的牛顿动量梯度下降而不用Adam，主要是因为使用Momentum加入惯性能够抑制震荡，使用Nesterov法能够在相关梯度方向进行加速.此外因为本文的图像篡改判别属于二分类问题，数据分布均衡容易计算，更适合SGD，而Adam更适合计算复杂分布的数据，此外由于篡改图像数据集数量相对于ImageNet较少，因此采用了Nesterov加速效果更好.

7）使用全局平均池化（GAP)替换全连接(FC)层，不仅能够保留前面卷积层提取到的篡改图像的空间信息和语义信息，同时能够减少模型中参数数量，比FC稳定.

8）使用空洞卷积(atrousconvolution）替代普通卷积.普通的卷积层为了减少网络的参数量，卷积核的设计通常选择较小的 $1 \times 1$ 和 $3 \times 3$ 感受野大小.小卷积核使得网络提取特征时的感受野区域有限，但是增大感受野的区域又会增加网络的参数量和计算代价，进而导致增大模型的复杂度.而使用空洞卷积在保证模型复杂度的情况下增大感受野，同时能够减少下采样倍数，并且保持参数量不变.同时相比于VGG16，去掉了池化层，提高了感受野.

# 1.3 基于传统方法和深度学习方法结合的图像鉴伪

传统的图像篡改取证方式通常具有对单一篡改技术的鉴别能力，深度学习可以自适应地提取篡改特征，但是这种自适应特征可控性较弱，可能含有与篡改特征无关的特征信息，导致计算量的增加甚至影响准确率.因此本文将ELA，CMYK，Laplacian和GLCM与深度学习方法融合，经过传统方法处理后的图像输入搭建好的CNN网络中进行模型训练，

常用的特征融合方法有：拼接concatenate和相加add.本文使用add进行特征融合，这种融合的图像维度不变，每一维度下的特征信息在增加，能够避免参数量的增加，进而避免模型幅度较大导致训练难度提升，不仅保留了各种特征而且可以调整alpha权重来分配特征的占比.

$i m a g e { = } i m g _ { 1 } { \times } ( 1 { - } a l p h a ) { + } i m g _ { 2 } { \times } a l p h a .$ (1)

本文经过多次实验验证发现Laplacian和GLCM等比融合后与CMYK颜色通道下的ELA误差水平值融合时alpha设置为0.2效果，然后与RGB颜色通道下的ELA误差水平值等比融合效果最佳.因此在GLCM,CMYK,Laplacian的基础上融合ELA，即在ELA基础上加入图像的底层特征(颜色、轮廓、纹理)来更好地进行篡改识别

设有长为 $x$ 个像素，宽为 $y$ 个像素，则某个位置 $( x , y )$ 最终的特征为

$$
F ( x , y ) { = } F _ { \mathrm { R G B \_ E L A } } ( x , y ) { + }
$$

$$
\xi _ { 0 . 8 } \times F _ { \mathrm { C M X K \_ E L A } } ( x , y ) +
$$

$$
0 . 2 { \times } [ F _ { \mathrm { L a p l a c i a n } } ( x , y ) + F _ { \mathrm { G L C M } } ( x , y ) ] \} .
$$

将完成这一系列操作后得到的Feature_map输入CNN网络中进行训练，训练好的模型会判断图像是否被篡改做出出最后的篡改概率的结果.

# 2 实验与结果分析

# 2.1图像篡改数据和实验环境

CASIA是现有篡判别算法中使用最多的数据，Columbia数据集有未压缩的拼接彩图，因此本文采用这2个数据集进行训练测试.CASIA数据集是由中科院自动化研究所提供各种对象的拼接和复制移图像.CASIAv1真实图800张，篡改图921张.该数据集是具有 $3 8 4 \times 2 5 6$ 和 $2 5 6 \times 3 8 4$ 分辨率的JPG格式图像.CASIA $\mathrm { v 2 }$ 真实图7491张，篡改图5123张.该数据集是具有 $3 8 4 \times 2 5 6$ 到600$\mathsf { \times 9 0 1 }$ 等多种分辨率大小，以及BMP，JPG和TIF三种图片格式的图像.CASIAv2相较于CASIAv1数据量更多、场景更复杂且还应用诸如过滤和模糊的一些后处理

# 2.2 评估指标

1）性能评估.本文主要通过混淆矩阵评估算法的性能，对于常见的二元分类来说，它的混淆矩阵是 $2 \times 2$ 的，如表1所示：

表1  

<html><body><table><tr><td>真实值</td><td>预测值=1(篡改图）</td><td>预测值=0（未篡改/真实图）</td></tr><tr><td>1</td><td>TP(true postive,真阳性）</td><td>FN(false negative,假阴性）</td></tr><tr><td>0</td><td>FP(falsepostive,假阳性）</td><td>TN(truenegative,真阴性）</td></tr></table></body></html>

准确率（accuracy， $A c c$ ）：对于给定的图像数据集，分类器正确分类的样本数与总样本数之比

$$
A c c = \frac { T P + T N } { T P + T N + F N + F P } .
$$

精准率(precision， $P$ ）：所有被识别为篡改的图像有多少是真正的篡改图像

$$
P { = } { \frac { T P } { T P + F P } } .
$$

召回率（recall， $R )$ ：所有被识别为篡改的图像占所有篡改图像数据集的比例

$$
R = { \frac { T P } { T P + F N } } .
$$

$F 1$ 值 $( F 1 -$ -score, $F 1 )$ ：统计学中用来衡量二分类模型精确度的一种指标，同时兼顾了分类模型的精准率和召回率，是精准率和召回率的加权调和平均，分值越高算法性能越好，

$$
F 1 { = } \frac { 2 P R } { P + R } { = } \frac { 2 T P } { 2 { \times } T \bar { P } + F P + F N } .
$$

2）模型复杂度评估.时间复杂度：计算量对应算法的时间复杂度，间接衡量模型的训练和预测时间，用浮点运算次数（floatingpointoperations，FLOPs)衡量.空间复杂度:参数量(Params)对应算法的空间复杂度，用模型内部总的参数数量来衡量模型的大小.

# 2.3 实验结果与分析

ELA，CMYK，Laplacian，GLCM几种传统方法以及特征融合的实验结果对比图，显然最后的融合使得篡改特征更明显，如表2所示：

![](images/a22aaf973d1a319282ff9fe591e761315a776acde3d6a2819d744843bdc7ec5f.jpg)  
表2实验结果

采用CSAIA数据集和Columbia数据集的$80 \%$ 进行训练， $10 \%$ 进行验证，训练好的模型采用混淆矩阵进行评估，最后使用训练好的模型在剩下的 $10 \%$ 的数据集上进行测试和指标评估.本文使用经典的VGG16分类网络进行对比评估，在原网络基础上将最后的全连接层修改为全局平均池化，重新开始训练自己的模型进行消融实验.文献[1，3]中的实验验证了当图像以 $90 \%$ 的质量水平压缩的时候图像的误差水平分析结果最佳.所以本文设置ELA中图像压缩质量级别为 $90 \%$ ，网络输入图像尺寸大小为（256，256，3），批次大小为64，优化器初始学习率为0.001，采用带牛顿加速的随机梯度下降法，动量设置为0.9，权重衰减参数设置为0.000001，训练周期数为50轮，评估结果如表3所示.

根据评估结果可以看到 $\mathrm { E L A } { + } \mathrm { V G G } 1 6$ 所提出模型的准确率、精准率、召回率、 $F 1$ 值普遍高于VGG16模型，而本文提出的模型测试结果其指标明显高于其他模型，与只使用ELA预处理的网络模型相比，准确率平均提高 $14 \%$ ，精准率平均提高$1 5 \%$ ，召回率平均提高 $8 . 3 \% , F 1$ 值平均提高 $12 . 7 \%$ 因此先采用本文所提出的几种传统方法进行特征提取并整合的预处理后再进行CNN网络模型的训练能够提高图像鉴伪能力，泛化能力更强，鲁棒性更高.

表3卷积神经网络结果评估表  

<html><body><table><tr><td rowspan="3">算法评估</td><td colspan="10">鉴伪结果</td></tr><tr><td colspan="3">CASIA1</td><td colspan="5">CASIA2</td><td colspan="3">Columbia</td></tr><tr><td></td><td>准确率</td><td>精准率</td><td>召回率</td><td>F1</td><td>准确率 精准率</td><td>召回率</td><td>F1</td><td>准确率</td><td>精准率</td><td>召回率</td><td>F1</td></tr><tr><td>ELA</td><td>0.63</td><td>0.57</td><td>1</td><td>0.73</td><td>0.65</td><td>0.59</td><td>0.98</td><td>0.73</td><td>0.72</td><td>0.65 0.85</td><td>0.74</td></tr><tr><td>VGG16</td><td>0.58</td><td>0.58</td><td>0.57</td><td>0.57</td><td>0.70</td><td>0.69</td><td>0.73</td><td>0.71 0.79</td><td>0.76</td><td>0.8</td><td>0.78</td></tr><tr><td>ELA+VGG16</td><td>0.67</td><td>0.61</td><td>0.91</td><td>0.74</td><td>0.87</td><td>0.89</td><td>0.89 0.87</td><td>0.77</td><td>0.85</td><td>0.6</td><td>0.71</td></tr><tr><td>Ours</td><td>0.88</td><td>0.96</td><td>0.79</td><td>0.87</td><td>0.93</td><td>0.89</td><td>0.96</td><td>0.93 0.93</td><td>0.95</td><td>0.9</td><td>0.92</td></tr></table></body></html>

# 3总结与展望

本文主要采用ELA等传统特征融合神经网络来训练模型进行图像鉴伪，实验结果表明本文提出的算法模型在准确率、精准率、召回率 $\therefore F 1$ 值上整体提高.此外，篡改的图像通常会经过平滑调整、压缩等后处理，或经过其他多种后处理融合操作来掩盖篡改痕迹，这种图像人类视觉很难判别，而深度学习能够自适应地学习这些特征.在未来的研究中将不断寻找更优的通用篡改特征来辅助辨别图像是否被篡改，不断提高图像鉴伪能力并且能够在保证复杂度的情况下定位到篡改区域

# 参考文献

[2]王品清，陈显尧.CMYK变换及其在图像处理与地学研究中的应用[J].地质通报，2006，25（Z1）：308-313  
[3]邢静，张艺驰，高俊钗.基于HSV色彩空间的改进红外与可见光图像融合算法研究.机械与电子，2022，40(12)：15-19  
[4]李淑芝，黎琛，邓小鸿.基于纹理复杂度的图像篡改定位和恢复水印算法[J].光电子，激光，2019，30（1)：44-51  
[5]覃圣淋.基于图像的纹理特性和统计特性的图像拼接篡改检测技术研究[D].沈阳：沈阳理工太学，20  
[6]陆明远，侯春燕，王劲松.基于Softplus函数的神经网络的Reluplex算法验证研究[J].信息安全研究，2022，8（9）：917-924

[1]徐亮.基于ELA和CrCb-GLCM的图像篡改检测[D].武汉：华中科技大学，2020

# 王鹏钧

助理研究员，主要研究方向为软件测评、图像处理，101351799@qq.com

# 常晓敏

硕士，助理研究员.主要研究方向为软件测评，

杨基宏助理研究员.主要研究方向为软件测评，

# 刘海敏

助理研究员.主要研究方向为保密管理.