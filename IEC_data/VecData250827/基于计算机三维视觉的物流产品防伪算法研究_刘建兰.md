# 基于计算机三维视觉的物流产品防伪算法研究

刘建兰，朱 丽（江西科技师范大学 数学与计算机科学学院，江西 南昌 330038）

[摘 要]为了解决物流产品的防伪防串货问题，提出对于每件物流产品赋予唯一的数字身份标识，并在物流过程中利用计算机三维视觉技术，对物流产品进行防伪身份查询。根据物流防伪信息管理系统对物流产品的防伪标识要求，提出了基于自适应权值的局部匹配算法，有效地区分了防伪标识图像边缘，消除了因亮度差而对图像匹配结果造成的影响，改善计算机三维视觉的视差图，从而帮助系统准确地对物流产品的防伪标识图像进行识别。通过仿真实验表明，基于本算法的物流产品防伪防串货识管理系统，可以有效识别物流产品外包装上的数字身份标识，且在多种外部条件下没有出现误读的情况，从而验证了算法的有效性和准确性。

[关键词]计算机视觉；三维视觉；立体匹配；防伪防串货 [中图分类号]TP391.41 [文献标识码]A [文章编号]1005- 152X（2014）01- 0354- 03

# Study on Logistics Product Anti-counterfeiting Algorithm Based on Computer-based 3D Vision

Liu Jianlan, Zhu Li (School of Mathematics & Computer Science, Jiangxi Normal University of Science & Technology, Nanchang 330038, China)

Abstract: In this paper, in order to solve the problems of counterfeiting and selling outside of authorized boundary in the logistics service industry, we proposed an anti-counterfeiting identity inquiry system based on the computer 3D vision technology, presented the specifics of the inquiry algorithm and at the end, through a simulation study, proved the validity and accuracy of the system. Keywords: computer vision; 3D vision; stereo matching; prevention of counterfeiting and sales out of authorized boundary

# 1 引言

在我国，有许多假冒伪劣产品充斥在市场环境中，而对于产品的防伪工作应从源头上抓起。首先，要加强物流产品流通渠道的管理，对物流产品从生产出库到批发商、配送企业、零售商、再到客户，进行全程防伪信息管理；其次，由于许多的生产企业没有物流渠道和缺乏对于产品的信息管理，从而导致个别经销商为了自身利益而不顾企业的市场管理政策，将所经销的产品跨区销售，这种窜货行为严重破坏了企业的市场管理。因此，要解决这些问题就要加强企业产品物流的防伪防串货信息管理与控制[1- 2]。

产品在出库时被赋予唯一的数字防伪标识，比如条形码、二维码、防伪图像等，通过两个或多个摄像机对产品进行防伪图像获取，将采集到的图像转换成数字信号，再将这些三维图像信息输送到计算机进行三维图像重建，获得被测产品防伪标识的三维数据，通过与产品信息库的数据进行匹配后，就能得到产品的详细信息。根据物流防伪信息管理系统对于防伪标识图像的要求，提出了一种可以有效区分目标物边缘的局部匹配算法，首先通过滤波处理消除不同亮度差对图像质量产生的影响，然后检测出图像中的误匹配点，从而准确地对图像进行三维重建。

# 2 问题分析

# 2.1 物流防伪信息管理

据统计，目前我国的产品在流通环节上的费用占了总费用的 $4 0 \% \sim 6 0 \%$ ，这不仅增加了消费者的负担，而且也严重影响了企业产品的推广。在美国，生产型企业通过建立物流管理体系，把产品在流通环节上的费用降到了 $2 0 \%$ 以下。因此，建立产品的物流防伪信息控制系统显得非常重要[3- 4]。

针对上述情况，系统赋予企业的每一个产品一组唯一的按国际编码规则编制的物流防伪监控标识。企业可以将密码印制成防伪标识粘贴在产品上。企业各级人员利用这个系统平台，可以管理产品流通信息、监控产品物流情况、监控产品真伪信息、统计产品的物流信息。消费者可以通过拨打全国统一查询电话，输入产品上的防伪密码，查询产品的真伪情况，了解产品和企业的相关信息等。其物流产品防伪信息管理系统流程如图1 所示。

![](images/e60d1bfa8bb01de9525e82e441e9e2e8ec76a61f56d6bb94300378273e8256f2.jpg)  
图 1 物流防伪系统流程图

每件产品都有唯一的数字身份标识，此标识可以是普通序列号，也可以是防伪图像、二维码等，并可以进行防伪查询，标识本身带有多种防伪手段。可以把经销商根据地区的不同进行划分、统计和管理；可以对不同产品的年 / 月或者任意时间段的销售量进行统计，包括根据经销商不同时期的销量统计不同产品。所有产品不用根据经销商定单的不同而区分生产，解决了成品库房不足和产品积压问题，只需配置一台电脑一个数据采集器就可以代替原来的手工记录、手工输入、手工翻阅资料、手工查询产品流向等范围的人工操作，真正在管理上实现了无纸化操作和信息传递。

由于数码标识的随机性和存储的安全性，使得造假者无法破译和窃取数码；而且企业只是用物流防伪标识替代原有的普通标识，在成本上没有增加。在验证物流信息时，市场打假人员将搜集到的产品信息在企业内部用局域网内部的任何一部电脑，即可查询到产品的流通信息，在管理上更上一层楼。

# 2.2 基于计算机视觉的解决方案

计算机视觉系统主要分为摄像机定标、立体匹配和三维重建三部分。利用图像传感器或者高速相机获取被测对象的图像，并将图像转化成数据矩阵，用计算机对数据进行综合分析与处理，然后完成与视觉、图像有关的检测工作。

将物流产品放在载物台上，并用光源对外包装进行照射，产品外包装上的防伪识别图像被摄像设备采集，并转换为数字信号传输到计算机内部，获取到灰度的二维阵列原始图像。然后对原始图像进行滤波处理，以及通过边缘提取和亚像素技术得到原始图像的亚像素级边缘，以提高原始图像的质量。应用计算机三维视觉的局部匹配算法，提取有用的图像特征，对图像特征进行分类整理，完成对图像更高层圈的描述以及三维重建，并与产品库中的产品信息数据进行匹配对比，完成计算机视觉系统所要求的防伪标识检测任务。其物流产品防伪检测平台示意图如图2 所示。

![](images/e09f6a002dcfcb10996c353986e2526485efdfb1e38f10e6b07765a148ef78b1.jpg)  
图 2 产品防伪检测平台

# 3 算法研究

# 3.1 改进的局部匹配算法

基于一种简单硬判决策略来决定图像匹配点： $\mathbf { \varPsi }$ 和 ${ \mathrm { I } } _ { \mathrm { r } }$ 分别表示获取图像和目标图像，其中， $\mathsf { \Pi } _ { \mathsf { N } } \in \mathsf { I } _ { \mathrm { t } }$ 和 ${ \mathsf p } { \in }  { \mathrm { I } _ { \mathrm { r } } }$ ；计算扫描线上每个点的匹配代价收集，如果 $\mathfrak { p }$ 点与 $\mathsf { g }$ 点为匹配点，那么以 $\mathfrak { p }$ 点和 g 点为中心的窗口，匹配代价的收集为最小；其视图差为d，为p 点与 g 点横坐标之差。设 ${ \sf W } _ { \sf k }$ 为右移系数，则 ${ \sf W } _ { \sf k }$ 为：

$$
W _ { k } = \delta ( p , g ) > > k
$$

$$
C _ { s } ( p , g , d ) = \sum _ { p _ { i } \in S _ { P } } \operatorname* { m i n } ( \delta ( p , g _ { i } ) > > W _ { k } , T _ { r } )
$$

$3 5 ; k = 6 ; S _ { p }$ $\mathrm { ~ \bf ~ p ~ }$

窗口图像中某些区域的像素颜色强度与中心点会有所不同，所以要将这些点的匹配代价右移两位，目的是为了减少与中心点有不同视图差的像素点的影响。而前景图像中的膨胀现象是因为窗口图像中有着不同深度的像素点，为了解决这个问题，提出一种基于代价收集方法的假设，假设内容是为：原始图像中不同颜色的像素点属于不同的深度点。

为了减少因视图差不连续而对匹配代价的影响，可以通过在式（2）中引用右移系数，增加图像不同亮度视图差的精度。解决了前景图像膨胀的问题，就可以增大窗口的尺寸，以获取更多的像素点、信息点，增强整个算法的鲁棒性。

由于噪声对光学传感器的影响，单个像素的灰度值会存在较大的不确定性，且灰度图像的灰度值只有 256 种，不同图像上点的灰度值也是不同的，就使得仅仅依靠一个点的灰度值信息，不足以寻找到正确的匹配点。因此，采用基于自适应权值的局部三维匹配算法，用窗口匹配的方式来增强匹配的鲁棒性，即利用图像周边区域像素点灰度值的相近性来补充单个点匹配信息的不足问题，所以，不同的窗口大小尺寸会生成不同质量的视差图[5- 6]。

窗口的大小与图像的噪声点成反比。窗口增大，噪声点减少，同时视图差平滑，但是图像的边缘也会随之模糊，而且窗口越大前景图像边缘的扩散范围越大。因此，得出结论：窗口的大小对三维立体匹配的性能有着很大影响。基于自适应权值的局部匹配算法，可以使原始图像中防伪标识区域产生图像质量较好的平滑视图差，即使在检测能力的最远距离附近，目标边缘亦较清晰，满足各种条件下物流防伪标识的识别要

求，且高效误码率较低。

# 3.2 图像滤波处理方法

摄像机的定位坐标不同，光源照射角度不同以及摄像机的光学传感器电平不相同等，都会对图像质量产生不同影响，影响图像的三维匹配，所以在对物流产品防伪标识图像的采集和匹配之前，需要进行滤波处理，在不影响实时性的前提下，使用一种简单有效的滤波方法，可以在归一化亮度的同时，有效地增强图像中的纹理细节，用窗口滑过整个图像，窗口中心点的灰度Ic 为：

$$
I _ { c } = \operatorname* { m i n } \left[ \operatorname* { m a x } ( I _ { c } - \overline { { I } } , - I _ { c a p } ) , I _ { c a p } \right]
$$

其中，I 为窗口内像素的平均灰度值， $\mathrm { { { \cal J } _ { c a p } } }$ 是手动设定限制值。

使用滤波消除了亮度差异对立体匹配的影响之后，所得到的视差图较接近没亮度差异时的视差图质量。而对于图像中有遮挡点的判断和预测是检测误匹配点的重要步骤，过程如下：在得到某点 p 在目标图像的匹配点 q 后，沿扫描线检查其他点的匹配代价收集，如果有一点i 与匹配点 q 的匹配代价收集值在 $1 + k \%$ 的范围内，点 i 又不是匹配点 q 的邻点，则判定p 点为误匹配。

# 3.3 三维坐标的计算

在得到图像对的视差图之后，即可计算图像中像素点所代表物点的物理空间三维坐标。

其中， $d = x _ { 1 } - x _ { 1 }$ 为像素点的视差； $\therefore ( C _ { x } ^ { 1 } , C _ { x } ^ { 1 } )$ 为主点被定标到分别在左右图像中拥有相同的像素坐标；f 为焦距；T 为左右摄像机的距离。由式（5）和式（6）得到的(X,Y,Z)即为左摄像机坐标系中物点的物理空间三维坐标，如果要得到右摄像机中的三维坐标，将式（5）、式（6）中的 $( x _ { 1 } , y _ { 1 } )$ 替换为 $( x _ { r } , y _ { r } )$ 即可。

# 4 仿真实验与分析

本系统测试采用 2 台黑白 CCD 工业摄像机，确定左右摄像机的坐标位置，左右摄像机中心距离为 15cm，物流产品距离摄像机的距离为 $1 0 c m - 2 0 c m$ ，检测平台的速度为 5cm/s,每件物流产品的包装不同，防伪标识图像位置不同，在以上实验条件下进行测试。物流产品防伪二维码图像如图3 所示。

分别对 10 个物流产品的外包装防伪标识进行扫描识别，并将三维立体匹配与数据库中的防伪信息图像进行对比。其检测结果见表 1。

表 1 检测结果对比  

<html><body><table><tr><td>产品序号</td><td>实测</td><td>标准</td><td>误差</td></tr><tr><td>1</td><td>83.09</td><td>83.05</td><td>0.04</td></tr><tr><td>2</td><td>85.64</td><td>85.66</td><td>0.02</td></tr><tr><td>3</td><td>76.56</td><td>76.53</td><td>0.03</td></tr><tr><td>4</td><td>78.82</td><td>78.79</td><td>0.03</td></tr><tr><td>5</td><td>78. 13</td><td>78. 17</td><td>0.04</td></tr><tr><td>6</td><td>89.35</td><td>89.30</td><td>0.05</td></tr><tr><td>7</td><td>62.95</td><td>62.99</td><td>0.04</td></tr><tr><td>8</td><td>89.52</td><td>89.56</td><td>0.04</td></tr><tr><td>9</td><td>80.12</td><td>80.17</td><td>0.05</td></tr><tr><td>10</td><td>80.23</td><td>80.18</td><td>0.05</td></tr><tr><td>平均误差</td><td></td><td></td><td>0.04</td></tr></table></body></html>

根据表 1 的对比结果得出，平均误差为 0.04；相对误差为$0 . 0 0 3 4 \% \sim 0 . 0 0 6 2 \%$ ；最大置信误差为 0.01。

仿真结果表明，基于计算机三维视觉的物流产品信息识别系统，可以准确检测产品外包装上的防伪标识，而其运行效率稳定、信息读取准确等优点是传统的手动检测方法所不能比拟的。因此，该物流产品防伪方法是有效的，且值得在物流行业中推广使用。

# 5 结语

基于计算机三维视觉技术的物流产品防伪检测方法，具有诸多优点并且已经在实际生产中得到广泛应用。该方法具有较好的快速性，能够满足实时检测的要求，并且测量精度很高。通过以上分析研究可知，基于改进的立体匹配算法和图像滤波方法，能准确地重建原始图像，并且具有精度高、非接触测量、运行高效等诸多优点，非常适合物流行业对于产品的防伪、防串货以及对产品进行全程跟踪等操作。在图像匹配过程中，利用基于自适应权值的局部匹配方法，减少了误匹配的机会，进一步提高了图像的精度和处理速度。从仿真结果看出，应用该防伪检测方法的物流管理系统，其检测精度能够满足检测物流产品防伪标识的精度要求。

# [参考文献]

[1]刘扬,唐芬南；包装防伪技术的现状与发展趋势—综合防伪包装[J].中国包装工业,2002,(4).

[2]徐建东,蒋野,孙迎春,李帅,孙凯,姜国千.基于改进的形态学算子的灰度图像边缘检测[J].佳木斯大学学报(自然科学版),2009,(6).  
[3]陈宝林.最优化理论与算法[M].北京：清华大学出版社,2005  
[4]高利涛,涂亚庆,齐永生.计算机视觉测量中摄像机快速标定方法实现[J].后勤工程学院学报,2009,(3).  
[5]沙增强.数码防伪技术的推广应用[J].中国品牌与防伪,2006,(11).  
[6]姚庆梅,牛君.一种基于方向形态学的图像轮廓提取方法[J].山东大学学报(工学版),2005,(4).